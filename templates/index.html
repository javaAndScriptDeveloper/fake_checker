<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WebSocket Example</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.0/socket.io.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const socket = io();

            socket.on('source_details', (data) => {
                let row = document.getElementById('source-' + data.id);
                if (!row) {
                    row = document.createElement('tr');
                    row.id = 'source-' + data.id;
                    row.classList.add('table-success');
                    document.getElementById('sources-table').appendChild(row);
                } else {
                    row.classList.add('table-warning');
                }
                row.innerHTML = `
                    <td>${data.platform}</td>
                    <td>${data.name}</td>
                    <td class="rating">${data.rating}</td>
                `;
                setTimeout(() => {
                    row.classList.remove('table-success', 'table-warning');
                }, 2000);
            });

            document.getElementById('submit').addEventListener('click', () => {
                const sourceId = document.getElementById('source-dropdown').value;
                socket.emit('add_source', sourceId);
            });

            // Fetch sources for dropdown
            fetch('/sources')
                .then(response => response.json())
                .then(data => {
                    const dropdown = document.getElementById('source-dropdown');
                    data.forEach(source => {
                        const option = document.createElement('option');
                        option.value = source.id;  // Use source ID as value
                        option.textContent = source.name;
                        dropdown.appendChild(option);
                    });
                });
        });
    </script>
    <style>
        body {
            padding: 20px;
        }
        .table-container {
            margin-top: 20px;
        }
        .form-container {
            margin-top: 20px;
        }
        .table-success {
            animation: fadeIn 1s;
        }
        .table-warning {
            animation: fadeOut 1s;
        }
        @keyframes fadeIn {
            from {
                background-color: #d4edda;
            }
            to {
                background-color: transparent;
            }
        }
        @keyframes fadeOut {
            from {
                background-color: #fff3cd;
            }
            to {
                background-color: transparent;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-center">Sources Table</h1>
        <div class="table-container">
            <table class="table table-bordered">
                <thead class="thead-dark">
                    <tr>
                        <th>Platform</th>
                        <th>Name</th>
                        <th>Rating</th>
                    </tr>
                </thead>
                <tbody id="sources-table">
                    {% for source in sources %}
                        <tr id="source-{{ source.id }}">
                            <td>{{ source.platform }}</td>
                            <td>{{ source.name }}</td>
                            <td class="rating">{{ source.rating }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="form-container">
            <h2>Add Source</h2>
            <div class="form-group">
                <label for="source-dropdown">Select Source:</label>
                <select id="source-dropdown" class="form-control">
                    <option value="" disabled selected>Select a source</option>
                </select>
            </div>
            <button id="submit" class="btn btn-primary">Add</button>
        </div>
    </div>
</body>
</html>
